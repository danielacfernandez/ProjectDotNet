<?xml version="1.0" encoding="utf-8"?>
<config EngineVersion="1.0.2.25">
    <version number="1.0.0.188" author="" dateCreation="2020-03-27" dateLastChange="2020-09-11"></version>
    <connectionString></connectionString>
    <grid>
        <viewType>grid</viewType>
        <pageSize>50</pageSize>
        <fixedColumns>0</fixedColumns>
        <title>Widget Time To Put In</title>
        <defaultOrder>ResourceID</defaultOrder>
        <templateEdit style=""><![CDATA[]]></templateEdit>
        <allowExport>True</allowExport>
        <allowCustomization>True</allowCustomization>
        <refreshGridAfterSaveRecord>False</refreshGridAfterSaveRecord>
        <allowPageSizeSelection>True</allowPageSizeSelection>
        <allowPageSelection>True</allowPageSelection>
        <allowMultipleSelection>False</allowMultipleSelection>
        <defaultMultipleSelection>False</defaultMultipleSelection>
        <displayRowCursor>True</displayRowCursor>
        <sqlSelect><![CDATA[SELECT SLTE.ResourceID, R.[NAME] AS ResourceName, MIN(D.FullDateUSA) AS [WEEK], 
	CASE WHEN TS.ISAPPROVED = -1 THEN 'REJECTED'
		 WHEN TS.ISAPPROVED = 0 THEN 'NOT SUBMITTED'
		 WHEN TS.ISAPPROVED = 1 THEN 'APPROVED'
	END AS TIMESHEETSTATUS,
	SUM(SLTE.HoursWorked) AS HOURSWORKED, ISNULL(U.WeeklyWorkCapacity,0) AS WEEKLYWORKCAPACITY
FROM [dbo].[ServiceLineTimeEntry] SLTE
JOIN DBO.DimDate D
	ON SLTE.TimeEntryDate = D.Date
LEFT JOIN (
	SELECT TS.ResourceID, D.WeekOfYear, MIN(ISNULL(TS.ISAPPROVED,0)) AS ISAPPROVED
	FROM DBO.TimeSheet TS
	JOIN DBO.DimDate D
		ON TS.TimeSheetDate = D.Date
	GROUP BY TS.ResourceID, D.WeekOfYear
) TS
	ON SLTE.RESOURCEID = TS.ResourceID AND D.WeekOfYear = TS.WeekOfYear
JOIN DBO.RESOURCES R
	ON SLTE.ResourceID = R.RESOURCE_ID
LEFT JOIN DBO.AspNetUsers U
	ON R.USER_ID = U.UserId
WHERE SLTE.HoursWorked > 0 
	AND (
		(D.WeekOfYear = (SELECT WeekOfYear FROM DBO.DimDate WHERE FullDateUSA = CAST(CURRENT_TIMESTAMP AS DATE))
			AND YEAR = YEAR(CURRENT_TIMESTAMP))
		OR
		(D.WeekOfYear = (SELECT WeekOfYear FROM DBO.DimDate WHERE FullDateUSA = CAST(CURRENT_TIMESTAMP AS DATE)) - 1
			AND YEAR = YEAR(CURRENT_TIMESTAMP))
		OR 
		(D.WeekOfYear = CASE WHEN (SELECT WeekOfYear FROM DBO.DimDate WHERE FullDateUSA = CAST(CURRENT_TIMESTAMP AS DATE)) = 1
							THEN (SELECT MAX(WEEKOFYEAR) FROM DBO.DIMDATE WHERE YEAR = (YEAR(CURRENT_TIMESTAMP) - 1))
							END
			AND YEAR = (YEAR(CURRENT_TIMESTAMP) - 1))
	)
GROUP BY SLTE.ResourceID, R.[NAME], TS.ISAPPROVED, ISNULL(U.WeeklyWorkCapacity,0)]]>
<parameters /></sqlSelect>
        <sqlUpdate where="[SkillId]=@SKILLID" autoUpdateQuery="False" updateTable=""><![CDATA[]]></sqlUpdate>
        <sqlInsert where="[SKILLID]=@@IDENTITY"><![CDATA[]]></sqlInsert>
        <sqlDelete><![CDATA[]]></sqlDelete>
        <buttons></buttons>
        <columns>
<column id="ResourceID" label="Resource" width="200" editable="True" filterable="True" filterItemsSize="100" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column>
<column id="ResourceName" label="Resource Name" width="200" editable="True" filterable="True" filterItemsSize="100" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="200"></column>
<column id="WEEK" label="Week" width="200" editable="True" filterable="True" filterItemsSize="100" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="200"></column>
<column id="TIMESHEETSTATUS" label="TS Status" width="200" editable="True" filterable="True" filterItemsSize="100" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="200"></column>
<column id="HOURSWORKED" label="Hs. Worked" width="200" editable="True" filterable="True" filterItemsSize="100" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column>
<column id="WEEKLYWORKCAPACITY" label="Weekly Work Cap." width="200" editable="True" filterable="True" filterItemsSize="100" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column></columns>
        <sqlColumns><![CDATA[]]></sqlColumns>
        <sqlTemplateEdit><![CDATA[]]></sqlTemplateEdit>
        <sqlGridProperties><![CDATA[]]></sqlGridProperties>
    </grid>
</config>