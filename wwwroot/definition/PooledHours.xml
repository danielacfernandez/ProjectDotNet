<?xml version="1.0" encoding="utf-8"?>
<config EngineVersion="1.0.2.25">
    <version number="1.0.0.40" author="" dateCreation="2020-04-30" dateLastChange="2021-03-03"></version>
    <connectionString></connectionString>
    <grid>
        <viewType>grid</viewType>
        <pageSize>50</pageSize>
        <fixedColumns>0</fixedColumns>
        <title>Billing By Item</title>
        <defaultOrder>JOB_ID</defaultOrder>
        <templateEdit style=""><![CDATA[]]></templateEdit>
        <allowExport>True</allowExport>
        <allowFullScreen>False</allowFullScreen>
        <allowCustomization>True</allowCustomization>
        <refreshGridAfterSaveRecord>False</refreshGridAfterSaveRecord>
        <allowPageSizeSelection>True</allowPageSizeSelection>
        <allowPageSelection>True</allowPageSelection>
        <allowMultipleSelection>False</allowMultipleSelection>
        <defaultMultipleSelection>False</defaultMultipleSelection>
        <displayRowCursor>True</displayRowCursor>
        <sqlSelect><![CDATA[SELECT 
	J.JOB_ID,
	'<a href="#" onclick="openPooledHrs('+cast( J.JOB_ID as varchar)+')">' + cast( J.JOB_NO as varchar) + '</a>' as JOB_NO, 
	J.JOB_NAME, 
	J.customer_name, 
	J.end_user_name, 
	J.job_status_type_name, 
	J.DATE_CREATED
			FROM DBO.jobs_v J
			JOIN (
				SELECT JOB_ID, COUNT(*) POOLEDREQCNT
				FROM DBO.services 
				WHERE INTERNAL_REQ_FLAG = 'Y'
				GROUP BY JOB_ID
			)s
				ON J.JOB_ID = S.JOB_ID
 JOIN DBO.PROJECTS P
	ON J.PROJECT_ID = P.PROJECT_ID
 JOIN DBO.CUSTOMERS C
	ON P.CUSTOMER_ID = C.CUSTOMER_ID
	and C.organization_Id = @ORGANIZATION_ID
 left join dbo.AspNetUserCustomers AUC with(nolock)
	on AUC.CustomerId = P.customer_id
		and AUC.UserId = (SELECT USERID FROM DBO.AspNetUsers WHERE USERNAME = @__LoginId__)
		and AUC.IsActive = 1
 JOIN [dbo].[AspNetUserOrganizations] UO
	on C.organization_id = UO.OrganizationId AND UO.USERID = (SELECT USERID FROM DBO.AspNetUsers WHERE USERNAME = @__LoginId__)
 JOIN DBO.AspNetUsers U
	ON UO.UserId = U.UserId AND U.USERNAME = @__LoginId__
 WHERE J.job_status_type_code <> 'CLOSED'
 and (
	AUC.AspNetUsersCustomersId is not null
	or
	/* users with no entry in dbo.AspNetUserCustomers have access to all customers.*/
	not exists (select top 1 * from dbo.AspNetUserCustomers AUC with(nolock) where UserId = (SELECT USERID FROM DBO.AspNetUsers WHERE USERNAME = @__LoginId__) and IsActive = 1)
 )
 AND (
	U.ExtDealerId IS NULL 
	OR 
	C.EXT_DEALER_ID = U.ExtDealerId
	OR 
	C.EXT_CUSTOMER_ID = U.ExtDealerId
 )]]>
<parameters /></sqlSelect>
        <sqlUpdate where="" autoUpdateQuery="False" updateTable=""><![CDATA[]]></sqlUpdate>
        <sqlInsert where=""><![CDATA[]]></sqlInsert>
        <sqlDelete><![CDATA[]]></sqlDelete>
        <buttons></buttons>
        <columns>
<column id="JOB_ID" label="JOB_ID" width="100" editable="False" filterable="True" filterItemsSize="200" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" headerAlign="left" editorType="html" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column>
<column id="JOB_NO" label="Job #" width="100" editable="False" filterable="True" filterItemsSize="200" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" headerAlign="left" editorType="html" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column>
<column id="CUSTOMER_NAME" label="Customer" width="100" editable="False" filterable="True" filterItemsSize="200" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" headerAlign="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column>
<column id="END_USER_NAME" label="End User" width="100" editable="False" filterable="True" filterItemsSize="200" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" headerAlign="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column>
<column id="JOB_NAME" label="Job Name" width="800" editable="False" filterable="True" filterItemsSize="200" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" headerAlign="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="200"></column>
<column id="job_status_type_name" label="Job Status" width="100" editable="False" filterable="True" filterItemsSize="200" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" headerAlign="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column>
<column id="DATE_CREATED" label="Date Created" width="100" editable="False" filterable="True" filterItemsSize="200" resizable="True" customizable="True" labelPrefix="" labelSuffix="" align="left" headerAlign="left" editorType="textbox" visible="True" format="" labelField="" dataSelect="" dataSelectCacheOnClient="True" preloadDataSelect="False" defaultFilter="" filterText="" size="10"></column></columns>
        <sqlColumns><![CDATA[]]></sqlColumns>
        <sqlTemplateEdit><![CDATA[]]></sqlTemplateEdit>
        <sqlGridProperties><![CDATA[]]></sqlGridProperties>
    </grid>
</config>