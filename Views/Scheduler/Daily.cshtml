@model ServiceTRAX.Models.ViewModels.DailySchedulerModel
@using ServiceTRAX.Utils
@using ServiceTRAX.Identity.Authorization

@{
    ViewData["Title"] = "Scheduler | ServiceTRAX - Powered by Omni Workspace Company";

    string ColumnWidth(string ColumnName)
    {
        int ColumnWidth = 500;
        switch (ColumnName.ToLower())
        {
            case "buttons": ColumnWidth = 140; break;
            case "job": ColumnWidth = 110; break;
            case "pono": ColumnWidth = 110; break;
            case "name": ColumnWidth = 180; break;
            case "reqname": ColumnWidth = 180; break;
            case "customer": ColumnWidth = 180; break;
            case "end_user_name": ColumnWidth = 180; break;
            case "organization_location": ColumnWidth = 120; break;
            case "jobrescount": ColumnWidth = 70; break;
            case "startdate": ColumnWidth = 110; break;
            case "enddate": ColumnWidth = 110; break;
            case "daysno": ColumnWidth = 80; break;
            case "start": ColumnWidth = 110; break;
            case "onsite": ColumnWidth = 110; break;
            case "pm": ColumnWidth = 250; break;
            case "lead": ColumnWidth = 250; break;
            case "crew": ColumnWidth = 425; break;
            case "vehicle": ColumnWidth = 280; break;
            case "hrsshift": ColumnWidth = 110; break;
            case "address": ColumnWidth = 408; break;
            case "notes": ColumnWidth = 408; break;
        }

        return $"min-width: {ColumnWidth}px; max-width: {ColumnWidth}px; width: {ColumnWidth}px;";
    }
}

@section StyleSheets {
    <link rel="stylesheet" href="~/css/datepicker.css" />
    <link rel="stylesheet" href="~/lib/trumbowyg/trumbowyg.min.css" />
    <link rel="stylesheet" href="~/js/jquery.floatingscroll.css" />
    <link rel="stylesheet" href="~/css/extraicons.css" />



    <style>

        .scheduler .resources-header .nav-tabs .nav-link.active {
            color: #0F2852;
            text-decoration: underline;
        }

        .scheduler .resources-header .nav-tabs .nav-link {
            color: #0099ff;
        }
    </style>
}


@section Scripts {
    <script type='text/javascript' src='~/lib/knockout/knockout-latest.js'></script>
    <script type='text/javascript' src='~/lib/moment/moment.min.js'></script>
    <script type='text/javascript' src='~/lib/datepicker.js'></script>
    <script type='text/javascript' src='~/lib/trumbowyg/trumbowyg.min.js'></script>
    <script type='text/javascript' src='~/js/ko-bindingHandlers.js' asp-append-version="true"></script>
    <script type='text/javascript' src='~/lib/signalr/signalr.min.js'></script>
    <script type='text/javascript' src='~/override/main-custom.js'></script>
    <script type='text/javascript' src='~/js/daily-scheduler.js' asp-append-version="true"></script>
    <script type='text/javascript' src='~/js/jquery.floatingscroll.min.js'></script>
    <script type='text/javascript' src='~/js/notification-dialog.js' asp-append-version="true"></script>

    <script type="text/javascript">

        $(function () {
            // Get the MVC model as JS
            var schedulerModel =  @Html.Raw(JSONUtils.JsonUTC(Model));
            // Initialize the Scheduler JS code
            initScheduler(schedulerModel);
        });

    </script>
}


<style type="text/css">

    table {
        text-align: left;
        position: relative;
        border-collapse: collapse;
    }

    th, td {
        padding: 0.25rem;
    }

    tr.red th {
        background: red;
        color: white;
        z-index: 100;
    }

    tr.green th {
        background: green;
        color: white;
    }

    tr.purple th {
        background: purple;
        color: white;
    }

    th {
        background: white;
        position: sticky;
        top: 0;
        box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4);
    }



    .collapsing {
        transition: none !important;
    }

    .resource-card-additional-skills {
        overflow-y: auto;
        height: 100px;
    }


    .ui-icon {
        width: 16px;
        height: 16px;
        background-image: url('img/ui-icons_222222_256x240.png'); /*{iconsContent}*/
    }

    .ui-resizable {
        position: relative;
    }

    .ui-resizable-handle {
        position: absolute;
        font-size: 0.1px;
        z-index: 99999;
        display: block;
    }

    .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle {
        display: none;
    }

    .ui-resizable-n {
        cursor: n-resize;
        height: 7px;
        width: 100%;
        top: -5px;
        left: 0px;
    }

    .ui-resizable-s {
        cursor: s-resize;
        height: 7px;
        width: 100%;
        bottom: -5px;
        left: 0px;
    }

    .ui-resizable-e {
        cursor: e-resize;
        width: 7px;
        right: -5px;
        top: 0px;
        height: 100%;
    }

    .ui-resizable-w {
        cursor: w-resize;
        width: 9px;
        /*left: 0px;*/
        top: 0px;
        height: 100%;
    }

    .ui-resizable-se {
        cursor: se-resize;
        width: 12px;
        height: 12px;
        right: 1px;
        bottom: 1px;
    }

    .ui-resizable-sw {
        cursor: sw-resize;
        width: 9px;
        height: 9px;
        /*left: px;*/
        bottom: -5px;
    }

    .ui-resizable-nw {
        cursor: nw-resize;
        width: 9px;
        height: 9px;
        /*left: -5px;*/
        top: -5px;
    }

    .ui-resizable-ne {
        cursor: ne-resize;
        width: 9px;
        height: 9px;
        right: -5px;
        top: -5px;
    }

    .ui-icon-gripsmall-diagonal-se {
        background-position: -64px -224px;
    }


    .selected-chip-border {
        background-image: linear-gradient(90deg, #0099ff 50%, transparent 50%), linear-gradient(90deg, #0099ff 50%, transparent 50%), linear-gradient(0deg, #0099ff 50%, transparent 50%), linear-gradient(0deg, #0099ff 50%, transparent 50%);
        background-repeat: repeat-x, repeat-x, repeat-y, repeat-y;
        background-size: 15px 2px, 15px 2px, 2px 15px, 2px 15px;
        background-position: left top, right bottom, left bottom, right top;
        animation: border-dance .5s infinite linear;
    }

    @@keyframes border-dance {
        0% {
            background-position: left top, right bottom, left bottom, right top;
        }

        100% {
            background-position: left 15px top, right 15px bottom, left bottom 15px, right top 15px;
        }
    }


    .cardhovereffect:hover {
        transform: scale(1.05);
        box-shadow: 0px 0px 12px 6px rgba(184,184,184,1);
        animation: expandResourceBox .25s;
        cursor: pointer;
    }

    @@keyframes expandResourceBox {
        from {
            transform: scale(1);
        }

        to {
            transform: scale(1.05);
        }
    }

    .expand-resource-button:hover {
        background-color: lightgray;
    }

    .sticky {
        z-index: 100;
        position: fixed;
        top: 120px;
        /*width: 100%;*/
    }

    .col80px {
        min-width: 110px;
        max-width: 110px;
        width: 110px;
    }

    .col100px {
        min-width: 100px;
        width: 100px;
    }

    .col110px {
        min-width: 110px;
        width: 110px;
    }

    .col150px {
        min-width: 130px;
        width: 130px;
    }

    .col250px {
        min-width: 250px;
        width: 250px;
    }

    .col300px {
        min-width: 250px;
        max-width: 250px;
        width: 250px;
    }

    .col-vehicle {
        min-width: 280px;
        width: 280px;
    }

    .col508px {
        min-width: 408px;
        max-width: 408px;
        width: 408px;
    }

    .col425px {
        min-width: 425px;
        max-width: 425px;
        width: 425px;
    }

    .simulate-button:hover {
        cursor: pointer;
    }

    .simulate-href:hover {
        cursor: pointer;
        color: #2d5daf;
    }

    .trumbowyg-box {
        margin-top: 0px;
        margin-bottom: 0px;
    }

    .ready-to-schedule-highlight {
        background-size: 20px 20px;
        background-image: linear-gradient(45deg, #f5f5f5 25%, #ededed 25%, #ededed 50%, #f5f5f5 50%, #f5f5f5 75%, #ededed 75%, #ededed 100%);
    }

    .table--blue th {
        background: #2d5daf;
        position: sticky;
        top: 0;
    }

    .table-scrollable-container {
        height: 500px;
        overflow-y: scroll;
    }

    .button-badge {
        position: relative;
        top: -19px;
        right: 23px;
        padding: 5px 7px;
        border-radius: 50%;
        color: white;
        border: 1px solid;
        background: #f70c0c;
        border-color: #ff6600;
        font-weight: bold;
    }

    .gray-icon:hover:disabled {
        cursor: default;
        color: unset;
    }

    ul.vehicelesanddrivers {
        list-style-type: none; /* Remove bullets */
        padding: 0; /* Remove padding */
        margin: 0; /* Remove margins */
    }

        ul.vehicelesanddrivers > li:not(:last-child) {
            border-bottom: solid 1px #e9e9e9;
        }

    .draggable-job {
        cursor: move
    }

    .driver-section {
        align-self: center;
        font-size: 1rem;
    }

    .driver-issues-color {
        color: #ff3636;
    }

    .driver-issues-chip {
        box-shadow: 0 0 0 3px #e9da12;
        outline: dashed 3px #f65a5a;
        background: #ffa9005c;
    }
</style>

@if (Model.IsMobileView)
{
    <style>
        .container-fluid {
            padding-left: 0px;
            padding-right: 0px;
        }
    </style>
}
else
{
    <style>
        .container-fluid {
            padding-left: 5px;
            padding-right: 5px;
        }
    </style>

}




<script type="text/html" id="scheduler-day-row">
    <td style="@ColumnWidth("buttons")" data-bind="if:isEditable && !$root.readOnlyView">
        <div class="d-flex">
            <button class="btn btn-sm icon-only gray-icon mx-0 pl-1" title="Remove this row" data-bind="click: function() { $root.displayRemoveRequestScheduleConfirmation(requestScheduleId, job_No, job_Name); }">
                <em class="fas fa-trash"></em>
            </button>
            <button class="btn btn-sm icon-only gray-icon mx-0 pl-1" title="Edit Job Dates and Role Quantities..." data-bind="click: function() { $root.editJobModal.showRoleAndQuantitiesDialog(requestScheduleId, startDate, endDate, hoursPerShift); }">
                <em class="fas fa-edit"></em>
            </button>
            <button class="btn btn-sm gray-icon icon-only mx-0 pl-1" title="Send Job Email..." data-bind="click: function() { $root.emailJobDialog.showDialog(requestScheduleId) }">
                <em class="fas fa-envelope"></em>
            </button>
            <button class="btn btn-sm gray-icon icon-only mx-0 pl-1" title="Send Customer Job Email..." data-bind="click: function() { $root.displayCustomerEmailConfirmation(requestScheduleId, job_No, job_Name) }">
                <em class="fas fa-envelope-open-text"></em>
            </button>
            <button class="btn btn-sm gray-icon icon-only mx-0 pl-1" data-bind="disable:isHardScheduled, click:function() { $root.displayHardScheduleConfirmation(request_id, job_No, job_Name); }, attr: {title: $root.hardScheduleButtonTitle(isHardScheduled)}">
                <em class="fas fa-calendar-check"></em>
            </button>
        </div>
    </td>
    <!-- ko if:lineType==='Field'-->
    <td style="@ColumnWidth("job")" class="simulate-href" data-bind="text: srNumber, visible: $root.schedulerCustomSettings.columns.jobno.visible(), click:() => $root.openSR(request_id)"></td>
    <!-- /ko -->
    <!-- ko ifnot:lineType==='Field'-->
    <td style="@ColumnWidth("job")" data-bind="text: srNumber, visible: $root.schedulerCustomSettings.columns.jobno.visible()"></td>
    <!-- /ko -->
    
    <td style="@ColumnWidth("pono")" data-bind="text: pono, visible: $root.schedulerCustomSettings.columns.pono.visible()"></td>
    <td style="@ColumnWidth("name")" data-bind="text: job_Name, visible: $root.schedulerCustomSettings.columns.jobname.visible()"></td>
    
    <td style="@ColumnWidth("reqname")" data-bind="text: request_Name, visible: $root.schedulerCustomSettings.columns.request_Name.visible()"></td>
    <td style="@ColumnWidth("customer")" data-bind="text: customer_name, visible: $root.schedulerCustomSettings.columns.customer_name.visible()"></td>
    <td style="@ColumnWidth("end_user_name")" data-bind="text: end_user_name, visible: $root.schedulerCustomSettings.columns.end_user_name.visible()"></td>
    <td style="@ColumnWidth("organization_location")" data-bind="text: $root.organizationLocationName(srLocationId), visible: $root.schedulerCustomSettings.columns.organization_location.visible()"></td>

    <td style="@ColumnWidth("jobrescount")" class="p-0" data-bind="visible: $root.schedulerCustomSettings.columns.jobresourcecount.visible()"><div class="count-card bg-1 p-2 text-center position-relative"><em class="fas fa-clock"></em>  <span data-bind="text: (totalHours * humanResourcesRequired)"></span></div></td>
    <td style="@ColumnWidth("jobrescount")" class="p-0" data-bind="visible: $root.schedulerCustomSettings.columns.jobresourcecount.visible()"><div class="count-card bg-2 p-2 text-center position-relative"><em class="fas fa-user"></em>  <span data-bind="text: humanResourcesRequired"></span></div></td>
    <td style="@ColumnWidth("jobrescount")" class="p-0" data-bind="visible: $root.schedulerCustomSettings.columns.jobresourcecount.visible()"><div class="count-card bg-3 p-2 text-center position-relative"><em class="fas fa-truck"></em> <span data-bind="text: vehicleResourcesRequired"></span> </div></td>
    <td style="@ColumnWidth("startdate")" class="text-center" data-bind="text: moment(new Date(startDate)).format('L'), visible: $root.schedulerCustomSettings.columns.startdate.visible()"></td>
    <td style="@ColumnWidth("enddate")" class="text-center" data-bind="text: moment(new Date(endDate)).format('L'), visible: $root.schedulerCustomSettings.columns.enddate.visible()"></td>
    <td style="@ColumnWidth("daysno")" class="text-center" data-bind="text: numberOfDays, visible: $root.schedulerCustomSettings.columns.numberofdays.visible()"></td>

    <td style="@ColumnWidth("start")" class="text-center" data-bind="visible: $root.schedulerCustomSettings.columns.whse.visible()">
        <input type="time" class="form-control" data-bind="value:wseStartTimeDisplay, attr: {readonly:!isEditable || $root.readOnlyView}" />
    </td>
    <td style="@ColumnWidth("onsite")" class="text-center" data-bind="visible: $root.schedulerCustomSettings.columns.field.visible()">
        <input type="time" class="form-control" data-bind="value:fieldStartTimeDisplay, attr: {readonly:!isEditable || $root.readOnlyView}" />
    </td>

    <td style="@ColumnWidth("pm")" data-bind="visible: $root.schedulerCustomSettings.columns.pm.visible()">
        <!-- ko if:isEditable && !$root.readOnlyView -->
        <select class="ml-1"
                data-style="btn-white shadow-sm"
                data-live-search="true"
                data-size="10"
                data-none-selected-text="..."
                data-bind="enable:isEditable && !$root.readOnlyView, selectPicker:true, options: $root.projectManagers, optionsText: 'projectManagerName', optionsValue: 'projectManagerID', value: projectManagerId, valueAllowUnset: true">
        </select>
        <!-- /ko -->
        <!-- ko ifnot:isEditable && !$root.readOnlyView -->
        <select class="ml-1"
                data-style="btn-white shadow-sm"
                data-live-search="true"
                data-size="10"
                data-none-selected-text="..."
                data-bind="enable:isEditable && !$root.readOnlyView, selectPicker:true"
                disabled>
            <option data-bind="text:projectManagerName"></option>
        </select>
        <!-- /ko -->

    </td>
    <td style="@ColumnWidth("lead")" data-bind="visible: $root.schedulerCustomSettings.columns.lead.visible()">
        <!-- ko template: { name: 'lead-chip-wrapper', data: {lead: lead, rowType: 'LEAD', editable: isEditable && !$root.readOnlyView } } -->
        <!-- /ko -->
        <div data-bind="if: lead().length === 0" class="text-center">N/A</div>
    </td>
    <td style="@ColumnWidth("crew")" data-bind="visible: $root.schedulerCustomSettings.columns.crew.visible()">
        <div class="row">
            <!-- ko template: { name: 'crew-chip-wrapper', data: {crew: crew, rowType: 'CREW', editable: isEditable && !$root.readOnlyView } } -->
            <!-- /ko -->
        </div>
    </td>
    <td style="@ColumnWidth("vehicle")" data-bind="visible: $root.schedulerCustomSettings.columns.vehicle.visible()">
        <div class="row">
            <div class="col">
                <ul class="vehicelesanddrivers">
                    <!-- ko foreach: vehicles -->
                    <li class="mb-2 ">
                        <div class="d-flex flex-column mb-2 ml-2">
                            <div data-bind="template: { name: $root.vehicleResourceChip }"></div>
                            <div class="mt-1">
                                <select data-style="btn-white shadow-sm"
                                        data-live-search="true"
                                        data-size="10"
                                        data-container="body"
                                        data-none-selected-text="..."
                                        data-bind="enable:!$root.readOnlyView && crewResourceID && !$root.driverDropdownsLocked(), selectPicker:true, options: $root.vehicleDriverOptions($parent.crew(), $parent.lead()), optionsText: 'crewName', optionsValue: 'crewResourceID', value: driverID, valueAllowUnset: true">
                                </select>
                                <button class="delete btn btn-sm icon-only gray-icon p-1" title="Remove assigned driver..." data-bind="visible:!$root.readOnlyView, click: function() { $data.driverID(null); }">
                                    <em class="fas fa-times"></em>
                                </button>
                            </div>
                        </div>
                    </li>
                    <!-- /ko -->
                </ul>
            </div>
        </div>
    </td>
    <td style="@ColumnWidth("hrsshift")" data-bind="text: hoursPerShift, visible: $root.schedulerCustomSettings.columns.hrsshift.visible()"></td>
    <td style="@ColumnWidth("address")" data-bind="text: address, visible: $root.schedulerCustomSettings.columns.address.visible()"></td>
    <td style="@ColumnWidth("notes")" data-bind="visible: $root.schedulerCustomSettings.columns.notes.visible()">
        <textarea rows="5" class="form-control" data-bind="value: notes, attr: {readonly:!isEditable || $root.readOnlyView}" style="width:100%"></textarea>
    </td>
</script>


<script type="text/html" id="driver-chip-section">

    <!-- ko ifnot:$root.driverChecks.warnDriver($data) -->
    <i class="ei-car-steering-wheel-svgrepo-com" title="Is Driver"></i>
    <!-- /ko -->
    <!-- ko if:$root.driverChecks.warnDriver($data) -->
    <button class="btn btn-sm icon-only gray-icon mr-1"
            data-toggle="popover"
            title="Driver Checks Warning"
            data-bind="popover, popoverOptions: { placement: 'left', trigger: 'hover', 'html': true }, attr: { 'data-content': $root.driverChecks.warnDriverMessage($data) }">
        <i class="ei-car-steering-wheel-svgrepo-com driver-issues-color"></i>
    </button>
    <!-- /ko -->

</script>


<script type="text/html" id="resource-template-crew-name">
    <div class="flex-grow-1 text-left" style="overflow-wrap:anywhere">
        <span class="resource-name" data-bind="text:crewName"></span>
    </div>
</script>


<script type="text/html" id="doublebooked-chip-mask">
    <div class="chip-heading position-absolute" title="Double booked">
        <span class="double-booked position-absolute">
            <i class="fas fa-exclamation-circle"></i>
        </span>
    </div>
</script>


<script type="text/html" id="resource-template-readonly">
    <div class="resource-chip position-relative btn btn-gray btn-sm d-flex" style="cursor:default"
         data-bind="css: { 'double-booked': isDoubleBooked, 'call-in':isCallIn  }">
        <div data-bind="template: { name: 'doublebooked-chip-mask', if:isDoubleBooked }"></div>
        <div class="d-flex align-items-center small-gutters ml-4">
            <div data-bind="template: { name: 'driver-chip-section', if:isDriver }, css: { 'white-icon': isCallIn } " class="driver-section mx-1"></div>
            <div>
                <!-- ko if: isCallIn-->
                <!-- ko if: $root.canSeeExceptions -->
                <button class="btn btn-sm icon-only white-icon mx-1"
                        data-toggle="popover"
                        data-bind="popover, popoverOptions: { placement: 'left', trigger: 'hover', 'title':$root.callOutOptionName(noShowLookupID) }, attr: { 'data-content': noShowReason ? noShowReason : 'Reason was not especified.' }">
                    <em class="fas fa-phone resource-note p-1"></em>
                </button>
                <!-- /ko -->
                <!-- ko ifnot: $root.canSeeExceptions -->
                <button class="btn btn-sm icon-only white-icon mx-1">
                    <em class="fas fa-phone resource-note p-1"></em>
                </button>
                <!-- /ko -->
                <!-- /ko -->
                <!-- ko if: exceptionNotes -->
                <!-- ko if: $root.canSeeExceptions -->
                <button class="btn btn-sm icon-only gray-icon mx-1"
                        data-toggle="popover"
                        title="Notes"
                        data-bind="popover, popoverOptions: { placement: 'left', trigger: 'hover' }, attr: { 'data-content': exceptionNotes }">
                    <em class="fas fa-sticky-note resource-note"></em>
                </button>
                <!-- /ko -->
                <!-- ko ifnot: $root.canSeeExceptions -->
                <button class="btn btn-sm icon-only gray-icon mx-1"
                        title="Notes">
                    <em class="fas fa-sticky-note resource-note"></em>
                </button>
                <!-- /ko -->
                <!-- /ko -->
                <em class="fas resource-role" data-bind="css: roleIconName"></em>
            </div>
            <!-- ko template: { name: 'resource-template-crew-name' } --><!-- /ko -->
        </div>
    </div>
</script>

<script type="text/html" id="resource-template-chip-remove">
    <div class="align-self-center text-right">
        <button class="delete btn btn-sm icon-only gray-icon" data-bind="click: function() { $root.removeCrewResource(requestScheduleCrewId, rowType); },  clickBubble: false">
            <em class="fas fa-times"></em>
        </button>
    </div>
</script>


<script type="text/html" id="resource-template-error">

    <div class="resource-chip call-in position-relative btn btn-gray btn-sm" style="background-color : red"
         data-bind="click: function() { $root.selectResourceChip($data, $parent.rowType) }, css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId } ">
        <div class="d-flex align-items-center small-gutters ml-2">
            <div>
                <em class="fas fa-exclamation resource-role"></em>
            </div>
            <div class="flex-grow-1 text-left">
                <span class="resource-name">Error</span>
            </div>
            <!-- ko template: { name: 'resource-template-chip-remove', data: {requestScheduleCrewId: requestScheduleCrewId, rowType: $parent.rowType } } --><!-- /ko -->
        </div>
    </div>

</script>


<script type="text/html" id="resource-template-callin">

    <div class="resource-chip call-in position-relative btn btn-gray btn-sm"
         data-bind="click: function() { $root.selectResourceChip($data, $parent.rowType) }, 
         css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId, 'driver-issues-chip':$root.driverChecks.warnDriverMessage($data) } ">
        <div class="d-flex align-items-center small-gutters ml-2">

            <div class="d-flex">
                <div data-bind="template: { name: 'driver-chip-section', if:isDriver }" class="driver-section"></div>
                <!-- ko if: $root.canSeeExceptions -->
                <button class="btn btn-sm icon-only white-icon mx-1"
                        data-toggle="popover"
                        data-bind="popover, popoverOptions: { placement: 'left', trigger: 'hover', 'title':$root.callOutOptionName(noShowLookupID) }, attr: { 'data-content': noShowReason ? noShowReason : 'Reason was not especified.' }">
                    <em class="fas fa-phone resource-note p-1"></em>
                </button>
                <!-- /ko -->
                <!-- ko ifnot: $root.canSeeExceptions -->
                <button class="btn btn-sm icon-only white-icon mx-1">
                    <em class="fas fa-phone resource-note p-1"></em>
                </button>
                <!-- /ko -->
                @*<em class="fas fa-phone resource-role mr-2"></em>*@
            </div>
            <!-- ko template: { name: 'resource-template-crew-name' } --><!-- /ko -->
            <!-- ko template: { name: 'resource-template-chip-remove', data: {requestScheduleCrewId: requestScheduleCrewId, rowType: $parent.rowType } } --><!-- /ko -->
        </div>
    </div>

</script>


<script type="text/html" id="resource-template-doublebooked">

    <div class="resource-chip double-booked position-relative btn btn-gray btn-sm"
         data-bind="click: function() { $root.selectResourceChip($data, $parent.rowType) },
         css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId, 'driver-issues-chip':$root.driverChecks.warnDriverMessage($data) } ">
        <div class="chip-heading position-absolute" title="Double booked">
            <span class="double-booked position-absolute">
                <i class="fas fa-exclamation-circle"></i>
            </span>
        </div>
        <div class="d-flex align-items-center small-gutters ml-3">
            <div data-bind="template: { name: 'driver-chip-section', if:isDriver }" class="driver-section"></div>
            <!-- ko if: exceptionNotes -->
            <div class="">
                <button class="btn btn-sm icon-only gray-icon mr-1"
                        data-toggle="popover"
                        title="Notes"
                        data-bind="popover, popoverOptions: { placement: 'left', trigger: 'hover' }, attr: { 'data-content': exceptionNotes }">
                    <em class="fas fa-sticky-note resource-note"></em>
                </button>
            </div>
            <!-- /ko -->
            <!-- ko if: isCallIn -->
            <div class="mr-1">
                <div class="d-flex">
                    <!-- ko if: $root.canSeeExceptions -->
                    <button class="btn btn-sm icon-only gray-icon mr-1"
                            data-toggle="popover"
                            data-bind="popover, popoverOptions: { placement: 'left', trigger: 'hover', 'title':$root.callOutOptionName(noShowLookupID) }, attr: { 'data-content': noShowReason ? noShowReason : 'Reason was not especified.' }">
                        <em class="fas fa-phone resource-note p-1"></em>
                    </button>
                    <!-- /ko -->
                    <!-- ko ifnot: $root.canSeeExceptions -->
                    <button class="btn btn-sm icon-only gray-icon mr-1">
                        <em class="fas fa-phone resource-note p-1"></em>
                    </button>
                    <!-- /ko -->
                    @*<em class="fas fa-phone resource-role"></em>*@
                </div>
            </div>
          
            <!-- /ko -->
            <div>
                <em class="fas resource-role mr-1" data-bind="css: roleIconName"></em>
            </div>
            <!-- ko template: { name: 'resource-template-crew-name' } --><!-- /ko -->
            <!-- ko template: { name: 'resource-template-chip-remove', data: {requestScheduleCrewId: requestScheduleCrewId, rowType: $parent.rowType } } --><!-- /ko -->
        </div>
    </div>

</script>







<script type="text/html" id="resource-template-normal">

    <div class="resource-chip position-relative btn btn-gray btn-sm"
         data-bind="click:  function() { $root.selectResourceChip($data, $parent.rowType) },
         css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId, 'driver-issues-chip':$root.driverChecks.warnDriverMessage($data)  } ">
        <div class="d-flex align-items-center small-gutters ml-2">
            <div data-bind="template: { name: 'driver-chip-section', if:isDriver }" class="driver-section"></div>
            <div>
                <!-- ko if: exceptionNotes -->
                <button class="btn btn-sm icon-only gray-icon mr-1"
                        data-toggle="popover"
                        title="Notes"
                        data-bind="popover, popoverOptions: { placement: 'left', trigger: 'hover' }, attr: { 'data-content': exceptionNotes }">
                    <em class="fas fa-sticky-note resource-note"></em>
                </button>
                <!-- /ko -->
                <em class="fas resource-role mr-1" data-bind="css: roleIconName"></em>
            </div>
            <!-- ko template: { name: 'resource-template-crew-name' } --><!-- /ko -->
            <!-- ko template: { name: 'resource-template-chip-remove', data: {requestScheduleCrewId: requestScheduleCrewId, rowType: $parent.rowType } } --><!-- /ko -->
        </div>
    </div>

</script>



<script type="text/html" id="lead-chip-wrapper">
    <div data-bind="text:editable" style="display:none"></div>
    <!-- ko if:editable-->
    <!-- ko foreach: lead -->
    <div class="col-6 mb-1" data-bind="template: { name: $root.crewResourceChip }"></div>
    <!-- /ko -->
    <!-- /ko -->
    <!-- ko ifnot:editable-->
    <!-- ko foreach: lead -->
    <div class="col-6 mb-1" data-bind="template: { name: 'resource-template-readonly' }"></div>
    <!-- /ko -->
    <!-- /ko -->
</script>

<script type="text/html" id="crew-chip-wrapper">
    <div data-bind="text:editable" style="display:none"></div>
    <!-- ko if:editable-->
    <!-- ko foreach: crew -->
    <div class="col-6 mb-1" data-bind="template: { name: $root.crewResourceChip }"></div>
    <!-- /ko -->
    <!-- /ko -->
    <!-- ko ifnot:editable-->
    <!-- ko foreach: crew -->
    <div class="col-6 mb-1" data-bind="template: { name:'resource-template-readonly' }"></div>
    <!-- /ko -->
    <!-- /ko -->
</script>





<script type="text/html" id="resource-template-empty">
    <button class="resource-chip add driver position-relative btn btn-soft-gray btn-sm"
            data-bind="click: function() { $root.selectResourceChip($data, $parent.rowType) }, css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId } ">
        <div class="row align-items-center small-gutters">
            <div class="col">
                <em class="fas fa-plus"></em>
                <!-- ko if:roleIconName -->
                <em class="fas resource-role" data-bind="css: roleIconName"></em>
                <!-- /ko -->
                <!-- ko ifnot:roleIconName -->
                <div class="badge" data-bind="text:roleAltIconCode"></div>
                <!-- /ko -->
            </div>
        </div>
    </button>
</script>

<script type="text/html" id="resource-template-pto">

    <div class="resource-chip double-booked position-relative btn btn-gray btn-sm"
         data-bind="click: function() { $root.selectResourceChip($data, $parent.rowType) }, css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId } ">
        <div class="row align-items-center small-gutters">
            <div class="col-auto offset-1">
                <div class="badge">PTO</div>
            </div>
            <div class="col text-left">
                <span class="resource-name" data-bind="text: crewName"></span>
            </div>
            <!-- ko template: { name: 'resource-template-chip-remove', data: {requestScheduleCrewId: requestScheduleCrewId, rowType: $parent.rowType } } --><!-- /ko -->
        </div>
    </div>

</script>


<script type="text/html" id="resource-vehicle-template">
    <div class="resource-chip position-relative btn btn-gray btn-sm"
         data-bind="click: function() { $root.selectResourceChip($data, 'VEHICLE') }
                    , css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId, 'double-booked': isDoubleBooked } ">
        <div data-bind="template: { name: 'doublebooked-chip-mask', if:isDoubleBooked }"></div>
        <div class="d-flex align-items-center small-gutters">
            <div class="col-auto offset-1">
                <em class="fas resource-role" data-bind="css: roleIconName"></em>
            </div>
            <div class="col text-left">
                <span class="resource-name" data-bind="text: crewName"></span>
                @*<span class="resource-name" data-bind="text: roleCode"></span>*@
            </div>
            <!-- ko template: { name: 'resource-template-chip-remove', data: {requestScheduleCrewId: requestScheduleCrewId, rowType: 'VEHICLE' } } --><!-- /ko -->
        </div>
    </div>
</script>

<script type="text/html" id="resource-readonly-vehicle-template">
    <div class="resource-chip d-flex position-relative btn btn-gray btn-sm" style="cursor:default"
         data-bind="css: { 'double-booked': isDoubleBooked }">
        <div data-bind="template: { name: 'doublebooked-chip-mask', if:isDoubleBooked }"></div>
        <div class="d-flex align-items-center small-gutters ml-4">
            <div>
                <em class="fas resource-role" data-bind="css: roleIconName"></em>
            </div>
            <!-- ko template: { name: 'resource-template-crew-name' } --><!-- /ko -->
        </div>
    </div>
</script>


<script type="text/html" id="resource-empty-vehicle-template">
    <button class="resource-chip add driver position-relative btn btn-soft-gray btn-sm"
            data-bind="click: function() { $root.selectResourceChip($data, 'VEHICLE') }, css: { 'selected-chip-border': $root.selectedResourceChip() === requestScheduleCrewId } ">

        <div class="row align-items-center small-gutters">
            <div class="col-auto offset-1">
                <em class="fas fa-plus"></em>
                <!-- ko if:roleIconName -->
                <em class="fas resource-role" data-bind="css: roleIconName"></em>
                <!-- /ko -->
                <!-- ko ifnot:roleIconName -->
                <div class="badge" data-bind="text:roleAltIconCode"></div>
                <!-- /ko -->
            </div>
        </div>
    </button>
</script>


<script type="text/html" id="resource-readonly-empty-vehicle-template">
    <button class="resource-chip add driver position-relative btn btn-soft-gray btn-sm" style="cursor:default">
        <div class="row align-items-center small-gutters">
            <div class="col-auto offset-1">
                <em class="fas fa-plus"></em>
                <!-- ko if:roleIconName -->
                <em class="fas resource-role" data-bind="css: roleIconName"></em>
                <!-- /ko -->
                <!-- ko ifnot:roleIconName -->
                <div class="badge" data-bind="text:roleAltIconCode"></div>
                <!-- /ko -->
            </div>
        </div>
    </button>
</script>



<script type="text/html" id="resource-human-card-template">
    <div class="card resource-card cardhovereffect" data-bind="click: function() { $root.assignCrewResource(resource_ID, 'HUMAN') }">
        <div class="card-header bg-green p-2" data-bind="style: {'background-color': $root.resourceCardColor(prctAssignedColor) }">
            <div class="row">
                <div class="col"><strong data-bind="text: resourceName"></strong></div>
                <div class="col-auto text-right"><strong data-bind="text: prctAssigned + '%'"></strong></div>
            </div><!--/row-->
            <div class="row mt-2">
                <div class="col" data-bind="ifnot: startTime && endTime">
                    <div class="callout p-2 text-center ucase">Unassigned<br />&nbsp;</div>
                </div>
                <div class="col-12" data-bind="if: startTime && endTime">
                    <div class="row small-gutters mt-2">
                        <div class="col-6">
                            <div class="callout p-2 text-center ucase">Start<br /><strong data-bind="text: moment(new Date(startTime)).format('LT')"></strong></div>
                        </div>
                        <div class="col-6">
                            <div class="callout p-2 text-center ucase">End<br /><strong data-bind="text: moment(new Date(endTime)).format('LT')"></strong></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body p-2">
            <div class="row small-gutters">
                <div class="col text-center"><em class="fas fa-dolly"></em> <div class="skill badge d-block" data-bind="text: moveSkill, style: {'background-color': $root.resourceLevelColor(moveSkill) }"></div></div>
                <div class="col text-center"><em class="fas fa-tools"></em> <div class="skill badge d-block" data-bind="text: installSkill, style: {'background-color': $root.resourceLevelColor(installSkill) }"></div></div>
                <div class="col text-center"><em class="fas fa-clipboard"></em> <div class="skill badge d-block" data-bind="text: leadSkill, style: {'background-color': $root.resourceLevelColor(leadSkill) }"></div></div>
                <div class="col text-center"><em class="fas fa-truck"></em> <div class="skill badge d-block" data-bind="text: driverSkill, style: {'background-color': $root.resourceLevelColor(driverSkill) }"></div></div>
            </div>

            <!-- ko if: skills.length > 0 && $root.resourceDisplayKind()==='skills' -->
            <div class="row small-gutters">
                <div class="col my-1 text-center expand-resource-button" title="Click to see additional skills..."
                     data-bind="click: function() { $('#cAdSkls' + resource_ID).collapse('toggle'); }, clickBubble: false"
                     aria-expanded="false" aria-controls="collapseJob1234">
                    <em class="fas fa-ellipsis-h"></em>
                </div>
            </div>
            <div class="collapse resource-expanded resource-card-additional-skills" data-bind="attr: {id: 'cAdSkls' + resource_ID}">
                <div class="resources-table w-100">
                    <div class="table-body" style="overflow-y: auto; height: 100px;">
                        <!-- ko foreach: skills -->
                        <div class="table-row">
                            <div class="text-left" data-bind="text: name"></div>
                            <div class="text-right"><strong data-bind="text: level"></strong></div>
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
            <!-- /ko -->

            <div class="resources-table w-100 mt-2" data-bind="if: $root.resourceDisplayKind()==='hoursworked'">
                <div class="table-body">
                    <div class="table-row">
                        <div class="text-left">Week to Date</div>
                        <div class="text-right"><strong data-bind="text: weekToDateHs"></strong></div>
                    </div>
                    <div class="table-row">
                        <div class="text-left">Past 7 Days</div>
                        <div class="text-right"><strong data-bind="text: past7DaysHs"></strong></div>
                    </div>
                    <div class="table-row">
                        <div class="text-left">Past 8 Days</div>
                        <div class="text-right"><strong data-bind="text: past8DaysHs"></strong></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-footer text-center bg-gray p-2 ucase">
            <strong data-bind="text: resourceType"></strong>
        </div>
    </div>
</script>


<script type="text/html" id="resource-vehicle-card-template">
    <div class="card resource-card cardhovereffect" data-bind="click: function() { $root.assignCrewResource(resource_ID, 'VEHICLE') }">
        <div class="card-header bg-green p-2" data-bind="style: {'background-color': $root.resourceCardColor(prctAssignedColor) }">
            <div class="row">
                <div class="col"><strong data-bind="text: resourceName"></strong></div>
                <div class="col-auto text-right"><strong data-bind="text: prctAssigned + '%'"></strong></div>
            </div><!--/row-->
            <div class="row mt-2">
                <div class="col" data-bind="ifnot: startTime && endTime">
                    <div class="callout p-2 text-center ucase">Unassigned<br />&nbsp;</div>
                </div>
                <div class="col-12" data-bind="if: startTime && endTime">
                    <div class="row small-gutters mt-2">
                        <div class="col-6">
                            <div class="callout p-2 text-center ucase">Start<br /><strong data-bind="text: moment(startTime).format('LT')"></strong></div>
                        </div>
                        <div class="col-6">
                            <div class="callout p-2 text-center ucase">End<br /><strong data-bind="text: moment(endTime).format('LT')"></strong></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body p-2">
        </div>

        <div class="card-footer text-center p-2 ucase">
            <strong data-bind="text: $root.vehicleCapabilitiesDescription($data)"></strong>
        </div>
    </div><!--/card resource-card-->
</script>


<body class="scheduler overflow-y">
    <div id="page">
        <div id="header-wrapper">
            <div id="header-mobile" class="d-lg-none bg-dark-blue">
                <div class="d-flex align-items-center">
                    <button class="btn icon-only" data-bind="click:showPrevDay" title="Move to Previous Day"><em class="fas fa-chevron-left"></em></button>
                    <div class="input-group col-6 col-sm-4 col-md-4 " id="triggerCalendarEndDate-mobile">
                        <input type="text"
                               autocomplete="off"
                               class="form-control"
                               id="estimatedEndDate-mobile"
                               data-bind="datepicker: date, datepickerOptions: {  trigger: '#triggerCalendarEndDate-mobile' }"
                               required />
                        <div class="input-group-append simulate-button">
                            <span class="input-group-text input-group-append-custom">
                                <i class="fas fa-calendar"></i>
                            </span>
                        </div>
                    </div>
                    <button class="btn icon-only" data-bind="click:showNextDay" title="Move to Next Day"><em class="fas fa-chevron-right"></em></button>

                    <div class="f-flex flex-column count-card text-center position-relative p-1">
                        <i class="fas fa-clock"></i> <div data-bind="text: totalClock()"></div>
                    </div>
                    <div class="d-inline-block count-card text-center position-relative p-1">
                        <i class="fas fa-user"></i> <div data-bind="text: totalMen()"></div>
                    </div>
                    <div class="d-inline-block count-card text-center position-relative p-1">
                        <i class="fas fa-truck"></i> <div data-bind="text: totalTruck()"></div>
                    </div>

                    <div class="ml-auto mr-2">
                        <button class="navbar-toggler d1-none orange-icon" type="button" style="border: 1px solid #ffffff45"
                                data-toggle="collapse" data-target="#scheduler-nav" aria-controls="scheduler-nav" aria-expanded="false" aria-label="Toggle navigation">
                            <i class="fa fa-user-cog" style="color: #ffffffd0"></i>
                        </button>
                    </div>
                </div>

                <nav class="main-subnav navbar navbar-expand-lg navbar-light bg-dark-blue">
                    <div class="collapse navbar-collapse" id="scheduler-nav">
                        <ul class="navbar-nav mr-auto main-subnav-list-mobile">

                            <li class="d-flex">
                                <div class="col-4 px-1">
                                    <a class="btn btn-primary btn-block" href="#" title="Summary" data-bind="click:loadDaySummary">
                                        <em class="fas fa-eye pr-1"></em> <span>Summary</span>
                                    </a>
                                </div>
                                @*<div class="col-4 px-1">
                                    <a class="btn btn-turquoise btn-block" href="#" title="Empty Jobs" data-bind="click:loadEmptyJobs">
                                        <em class="fas fa-ban pr-1"></em> <span>Empty Jobs</span>
                                    </a>
                                </div>
                                <div class="col-4 px-1">
                                    <a class="btn btn-orange btn-block" href="#" title="Exceptions" data-toggle="modal" data-target="#ExceptionsModal">
                                        <em class="fas fa-exclamation-triangle pr-1"></em> <span>Exceptions</span>
                                        <!-- ko if:schedulerExceptions().length > 0-->
                                        <span data-bind="text:'(' + schedulerExceptions().length + ')'"></span>
                                        <!-- /ko -->

                                    </a>
                                </div>*@
                            </li>

                            <li>
                                <div class="dropdown-divider"></div>
                            </li>

                            <li class="d-flex">
                                <div class="dropdown px-1 col-4">
                                    <button class="btn btn-white btn-block dropdown-toggle" type="button" id="dropdown-cols-mobile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <em class="fas fa-cog"></em> Customize
                                    </button>
                                    <div class="dropdown-menu" aria-labelledby="dropdown-cols-mobile" style="position:absolute">
                                        <div>
                                            <ul style="list-style-type: none; width: max-content;" class="px-4">
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.jobno.visible" /> Job #</label>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.pono.visible" /> PO/Order #</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.jobname.visible" /> Job Name</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.request_Name.visible" /> Request Name</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.customer_name.visible" /> Customer Name</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.end_user_name.visible" /> End User Name</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.organization_location.visible" /> Location</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.jobresourcecount.visible" /> Job Resources Count</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.startdate.visible" /> Start Date</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.enddate.visible" /> End Date</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.numberofdays.visible" /> # of Days</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.whse.visible" /> Start</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.field.visible" /> On-Site</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.pm.visible" /> PM</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.lead.visible" /> Lead</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.crew.visible" /> Crew</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.vehicle.visible" /> Vehicles</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.hrsshift.visible" /> Hs/Shift</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.address.visible" /> Address</label></li>
                                                <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.notes.visible" /> Notes</label></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-4 btn-group btn-group ml-auto px-1" role="group">
                                    <button type="button" class="btn btn-white btn-block" data-bind="click:() => filtersDialog.openDialog()">
                                        <em class="fas fa-filter mr-2"></em>JOB FILTERS <span data-bind="visible:jobFilters.anyFilterActive()" style="display:none">(FILTERING ON)</span>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-white" title="Clear current filters..." data-bind="enabled:jobFilters.anyFilterActive(), click:() => jobFilters.clearFilters()"><em class="fas fa-times"></em></button>
                                </div>
                            </li>

                        </ul>
                    </div>
                </nav>
            </div>

            <div id="header" class="d-none d-lg-block">
                <nav class="scheduler-nav navbar-dark bg-dark-blue">
                    <!-- <a class="navbar-brand" href="#"></i></a> -->
                    <div class="container-fluid">
                        <div class="d-flex align-items-center">
                            <div class="d-inline-block ml-2 mr-5">
                                <h2>Scheduler</h2>
                            </div>
                            <div class="d-inline-block count-card bg-1 text-center position-relative"><em class="fas fa-clock"></em> <span data-bind="text: totalClock()"></span></div>
                            <div class="d-inline-block count-card bg-2 text-center position-relative"><em class="fas fa-user"></em> <span data-bind="text: totalMen()"></span></div>
                            <div class="d-inline-block count-card bg-3 text-center position-relative"><em class="fas fa-truck"></em> <span data-bind="text: totalTruck()"></span></div>


                            <div class="ml-5" data-bind="visible:receivedJobPositionUpdate" style="display: none">
                                <a class="btn btn-orange" href="#" title="Refresh Jobs" data-bind="click:receivedJobPositionUpdateAction">
                                    <i class="fas fa-sync fa-spin mr-3"></i><span>Job Positions were Updated. Click here to Refresh the Job list.</span>
                                </a>
                            </div>


                            <div class="ml-auto d-none d-lg-block">
                                <div class="d-inline-block mr-1" requires-permission="@Permissions.SchedulerDayArrangeJobPositions">
                                    <a class="btn btn-primary" href="#" title="Reorder Day Jobs" data-bind="click:jobSortingModal.showDialog">
                                        <em class="fas fa-stream pr-1 mr-3"></em> <span>Re Order Jobs</span>
                                    </a>
                                </div>
                                <div class="d-inline-block mr-1">
                                    <a class="btn btn-primary" href="#" title="Summary" data-bind="click:loadDaySummary">
                                        <em class="fas fa-eye pr-1"></em> <span>Summary</span>
                                    </a>
                                </div>
                                @*<div class="d-inline-block mr-1">
                                    <a class="btn btn-turquoise" href="#" title="Empty Jobs" data-bind="click:loadEmptyJobs">
                                        <em class="fas fa-ban pr-1"></em> <span>Empty Jobs</span>
                                    </a>
                                </div>
                                <div class="d-inline-block mr-1">
                                    <a class="btn btn-orange" href="#" title="Exceptions" data-toggle="modal" data-target="#ExceptionsModal">
                                        <em class="fas fa-exclamation-triangle pr-1"></em> <span>Exceptions</span>
                                    </a>
                                    <!-- ko if:schedulerExceptions().length > 0-->
                                    <span class="button-badge" data-bind="text:schedulerExceptions().length"></span>
                                    <!-- /ko -->
                                </div>*@
                            </div>
                        </div>
                    </div><!--/container-->
                </nav>

                <div class="bg-blue p-2 d-flex align-items-center">

                    <button class="btn icon-only" data-bind="click:showPrevDay" title="Move to Previous Day"><em class="fas fa-chevron-left"></em></button>
                    <div class="input-group col-lg-2 col-xs-6 col-sm-4 col-md-4 " id="triggerCalendarEndDate">
                        <input type="text"
                               autocomplete="off"
                               class="form-control"
                               id="estimatedEndDate"
                               data-bind="datepicker: date, datepickerOptions: {  trigger: '#triggerCalendarEndDate' }"
                               required />
                        <div class="input-group-append simulate-button">
                            <span class="input-group-text input-group-append-custom">
                                <i class="fas fa-calendar"></i>
                            </span>
                        </div>
                    </div>
                    <button class="btn icon-only" data-bind="click:showNextDay" title="Move to Next Day"><em class="fas fa-chevron-right"></em></button>

                    <div class="ml-auto">
                        <div class="dropdown btn">
                            <button class="btn btn-sm btn-white dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <em class="fas fa-cog"></em> Customize
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                <div>
                                    <ul style="list-style-type: none; width: max-content;" class="px-4">
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.jobno.visible" /> Job #</label>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.pono.visible" /> PO/Order #</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.jobname.visible" /> Job Name</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.request_Name.visible" /> Request Name</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.customer_name.visible" /> Customer Name</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.end_user_name.visible" /> End User Name</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.organization_location.visible" /> Location</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.jobresourcecount.visible" /> Job Resources Count</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.startdate.visible" /> Start Date</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.enddate.visible" /> End Date</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.numberofdays.visible" /> # of Days</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.whse.visible" /> Start</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.field.visible" /> On-Site</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.pm.visible" /> PM</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.lead.visible" /> Lead</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.crew.visible" /> Crew</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.vehicle.visible" /> Vehicles</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.hrsshift.visible" /> Hs/Shift</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.address.visible" /> Address</label></li>
                                        <li><label data-bind="click: function() { return true; }, clickBubble: false"><input type="checkbox" value="true" data-bind="checked: $root.schedulerCustomSettings.columns.notes.visible" /> Notes</label></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="btn-group btn-group" role="group">
                            <button type="button" class="btn btn-sm btn-white" data-bind="click:() => filtersDialog.openDialog()">
                                <em class="fas fa-filter mr-2"></em>JOB FILTERS <span data-bind="visible:jobFilters.anyFilterActive()" style="display:none">(FILTERING ON)</span>
                            </button>
                            <button type="button" class="btn btn-sm btn-white" title="Clear current filters..." data-bind="enabled:jobFilters.anyFilterActive(), click:() => jobFilters.clearFilters()"><em class="fas fa-times"></em></button>
                        </div>

                        @*<button class="btn btn-sm btn-white" id="ShowEmptyResourcesButton" data-bind="click: function() { showEmptyResources(); }, text: showOnlyEmptyResourcesBtnTxt()"></button>*@
                    </div>
                </div>
            </div>
        </div>
        <div id="content" class="position-relative">
            <div class="container-fluid">
                <div data-bind="hidden: dayDataLoadCompleted()" style="display:none">
                    <div class="d-flex flex-row align-self-center justify-content-center">
                        <div class="d-flex align-items-center">
                            <div class="m-3">
                                <div class="spinner-grow" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                            <h5 data-bind="text: 'Loading Scheduler Data for ' + moment(date()).format('MM-DD-YYYY')"></h5>
                        </div>
                    </div>
                </div>

                <div data-bind="visible: dayDataLoadCompleted() && jobDayScheduleFiltered().length === 0 && jobDaySchedulePTOAndSvcAcctFiltered().length === 0" style="display:none">
                    <div class="d-flex justify-content-center">
                        <h5 data-bind="text: 'There is no Scheduler Data for ' + moment(date()).format('MM-DD-YYYY')"></h5>
                    </div>
                </div>
                <div class="row mr-0" data-bind="visible: dayDataLoadCompleted() && (jobDayScheduleFiltered().length > 0 || jobDaySchedulePTOAndSvcAcctFiltered().length > 0)" style="display:none">
                    <div class="col pr-0 mb-4">
                        <div id="scroll_wrapper" class="overflow-auto">
                            <table class="table table--gray scheduler-table" id="dayScheduleTable">
                                <thead id="schedheader">
                                    <tr>
                                        <th scope="col" style="@ColumnWidth("buttons")"></th>
                                        <th scope="col" style="@ColumnWidth("job")" data-bind="visible: $root.schedulerCustomSettings.columns.jobno.visible()">Job #</th>
                                        <th scope="col" style="@ColumnWidth("pono")" data-bind="visible: $root.schedulerCustomSettings.columns.pono.visible()">PO/Order #</th>
                                        <th scope="col" style="@ColumnWidth("name")" data-bind="visible: $root.schedulerCustomSettings.columns.jobname.visible()">Job Name</th>
                                        <th scope="col" style="@ColumnWidth("reqname")" data-bind="visible: $root.schedulerCustomSettings.columns.request_Name.visible()">Request Name</th>
                                        <th scope="col" style="@ColumnWidth("customer")" data-bind="visible: $root.schedulerCustomSettings.columns.customer_name.visible()">Customer Name</th>
                                        <th scope="col" style="@ColumnWidth("end_user_name")" data-bind="visible: $root.schedulerCustomSettings.columns.end_user_name.visible()">End User Name</th>
                                        <th scope="col" style="@ColumnWidth("organization_location")" data-bind="visible: $root.schedulerCustomSettings.columns.organization_location.visible()">Org. Location</th>
                                        <th scope="col" style="@ColumnWidth("jobrescount")" data-bind="visible: $root.schedulerCustomSettings.columns.jobresourcecount.visible()"></th>
                                        <th scope="col" style="@ColumnWidth("jobrescount")" data-bind="visible: $root.schedulerCustomSettings.columns.jobresourcecount.visible()"></th>
                                        <th scope="col" style="@ColumnWidth("jobrescount")" data-bind="visible: $root.schedulerCustomSettings.columns.jobresourcecount.visible()"></th>
                                        <th scope="col" style="@ColumnWidth("startdate")" data-bind="visible: $root.schedulerCustomSettings.columns.startdate.visible()">Start Date</th>
                                        <th scope="col" style="@ColumnWidth("enddate")" data-bind="visible: $root.schedulerCustomSettings.columns.enddate.visible()">End Date</th>
                                        <th scope="col" style="@ColumnWidth("daysno")" data-bind="visible: $root.schedulerCustomSettings.columns.numberofdays.visible()"># Days</th>
                                        <th scope="col" style="@ColumnWidth("start")" data-bind="visible: $root.schedulerCustomSettings.columns.whse.visible()">Start</th>
                                        <th scope="col" style="@ColumnWidth("onsite")" data-bind="visible: $root.schedulerCustomSettings.columns.field.visible()">On-Site</th>
                                        <th scope="col" style="@ColumnWidth("pm")" data-bind="visible: $root.schedulerCustomSettings.columns.pm.visible()">PM</th>
                                        <th scope="col" style="@ColumnWidth("lead")" data-bind="visible: $root.schedulerCustomSettings.columns.lead.visible()">Lead</th>
                                        <th scope="col" style="@ColumnWidth("crew")" data-bind="visible: $root.schedulerCustomSettings.columns.crew.visible()">Crew</th>
                                        <th scope="col" style="@ColumnWidth("vehicle")" data-bind="visible: $root.schedulerCustomSettings.columns.vehicle.visible()">Vehicle</th>
                                        <th scope="col" style="@ColumnWidth("hrsshift")" data-bind="visible: $root.schedulerCustomSettings.columns.hrsshift.visible()">Hrs/Shift</th>
                                        <th scope="col" style="@ColumnWidth("address")" data-bind="visible: $root.schedulerCustomSettings.columns.address.visible()">Address</th>
                                        <th scope="col" style="@ColumnWidth("notes")" data-bind="visible: $root.schedulerCustomSettings.columns.notes.visible()">Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- ko if: jobDayScheduleFiltered().length > 0 -->
                                    <!-- ko foreach: jobDayScheduleFiltered()-->
                                    <tr data-bind="template: {name:'scheduler-day-row'}, css: { 'ready-to-schedule-highlight': !isHardScheduled } ">
                                    </tr>
                                    <!-- /ko -->
                                    <!-- /ko -->
                                    <!-- ko if: jobDaySchedulePTOAndSvcAcctFiltered().length > 0 -->
                                    <!-- ko foreach: jobDaySchedulePTOAndSvcAcctFiltered() -->
                                    <tr data-bind="template: {name:'scheduler-day-row'}">
                                    </tr>
                                    <!-- /ko -->
                                    <!-- /ko -->
                                </tbody>
                            </table>
                        </div>
                    </div><!--/col-->
                </div><!--/row-->
            </div>
        </div>
        <div id="footer">
        </div>
    </div><!--/#page-->
    <!-- Call Out Modal -->
    <div class="modal fade" id="callOutModal" data-bind="showModal:callOutDialogShown" data-backdrop="static" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal" role="document" data-bind="with: selectedResource()">
            <div class="modal-content modal-content--dark-blue">
                <div class="modal-header align-items-center">
                    <div class="d-flex flex-column">
                        <h4 class="p-0 m-0" data-bind="text:crewName"></h4>
                        <h6 class="p-0 m-0">Call Out</h6>
                    </div>
                    <button type="button" class="btn icon-only" data-bind="click: function() { $root.showCallOutDialog(false); }">
                        <em class="fas fa-times"></em>
                    </button>
                </div>
                <div class="modal-body">
                    @*<div class="resources-header">
                            <ul class="nav nav-tabs" id="callOutTabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active ucase" id="callout-reason-tab" data-toggle="tab" href="#calloutreason" role="tab" aria-controls="skills" aria-selected="true">CALL-OUT</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link ucase" id="callout-notes-tab" data-toggle="tab" href="#calloutnotes" role="tab" aria-controls="hours" aria-selected="false">NOTES</a>
                                </li>
                            </ul>
                        </div>*@

                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane  show active pb-3" id="calloutreason" role="tabpanel" aria-labelledby="personnel-tab">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label class="" for="callouttypeselect">
                                        CALLOUT TYPE
                                    </label>
                                    <div class="d-flex" id="callouttypeselect">
                                        <select class=""
                                                data-style="btn-white shadow-sm"
                                                data-bind="selectPicker:true, options: $root.callOutOptions, optionsText: 'name', optionsValue: 'id', value: $root.callOutDialogValues.callOutTypeId,  valueAllowUnset: true"
                                                data-none-selected-text="...">
                                        </select>
                                        <button class="btn btn-sm btn-danger ml-2" type="button" data-bind="click: function() { $root.callOutDialogValues.callOutTypeId(null); $root.callOutDialogValues.reason(''); },  enable: $root.callOutDialogValues.callOutTypeId, attr: { title: `Clear call out for ${crewName}`}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2 mb-3">
                                <div class="col-12">
                                    <label for="callOutReasonTextarea">Notes</label>
                                    <textarea class="form-control" id="callOutReasonTextarea" rows="5" data-bind="textInput: $root.callOutDialogValues.reason"></textarea>
                                </div>
                            </div>
                        </div>
                        @*<div class="tab-pane  show pt-3 pb-3" id="calloutnotes" role="tabpanel" aria-labelledby="personnel-tab">
                                <div class="row mt-2 mb-3">
                                    <div class="col-12">
                                        <label for="callOutNotes">Notes</label>
                                        <textarea class="form-control" id="callOutNotes" rows="6" data-bind="textInput: $root.callOutDialogValues.notes"></textarea>
                                    </div>
                                </div>
                            </div>*@
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn  btn-danger ml-2" type="button" data-bind="click: function() {  $root.callOutDialogValues.updateCrew(requestScheduleCrewId); }, enable: $root.callOutDialogValues.saveButtonEnabled(), text: $root.callOutDialogValues.saveButtonText()">Save </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Summary Modal -->
    <div class="modal fade" id="JobSummaryModal" data-backdrop="static" data-bind="showModal:showSummaryByResourceDialog" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content modal-content--dark-blue">
                <div class="modal-header align-items-center">
                    <h4 class="p-0 m-0"><em class="fas fa-eye mr-2 lt-blue-icon"></em> Day Summary</h4>
                    <button type="button" class="btn icon-only" data-bind="click: function() { showSummaryByResourceDialog(false); }">
                        <em class="fas fa-times"></em>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="resources-header">
                        <ul class="nav nav-tabs" id="resourcesTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active ucase" id="personnel-tab" data-toggle="tab" href="#personnel" role="tab" aria-controls="skills" aria-selected="true">Personnel</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link ucase" id="trucks-tab" data-toggle="tab" href="#trucks" role="tab" aria-controls="hours" aria-selected="false">Trucks</a>
                            </li>
                        </ul>
                    </div><!--/resources-header-->
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active pt-3 pb-3" id="personnel" role="tabpanel" aria-labelledby="personnel-tab">
                            <div class="row align-items-center small-gutters mb-3">
                                <!-- ko foreach:daySummaryByRolesCrew() -->
                                <div class="col-3 mb-1">
                                    <div class="callout bg-blue p-2">
                                        <div class="text-center"><em class="fas fa-tools turquoise-icon mr-2"></em> <strong class="ucase" data-bind="text:rolName"></strong></div>
                                        <div class="resources-table w-100">
                                            <div class="table-body">
                                                <div class="table-row">
                                                    <div class="text-left">Required</div>
                                                    <div class="text-right"><strong data-bind="text: humanResourcesRequired"></strong></div>
                                                </div>
                                                <div class="table-row">
                                                    <div class="text-left">Allocated</div>
                                                    <div class="text-right"><strong data-bind="text: humanResourcesAllocated"></strong></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- /ko -->
                            </div>
                            <div class="row align-items-center">
                                <div class="col-auto mr-3">
                                    <big class="text-tan ucase">Totals:</big>
                                </div>
                                <div class="col">
                                    <big><span data-bind="text:daySummaryTotalRequired()"></span> <span class="text-turquoise">//</span> <span data-bind="text:daySummaryTotalAllocated()"></span></big>
                                </div>
                            </div><!--/row-->

                        </div><!--/tab-pane-->
                        <div class="tab-pane fade p-3" id="trucks" role="tabpanel" aria-labelledby="trucks-tab">

                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="callout bg-blue p-2">
                                        <div class="text-center mb-2"><em class="fas fa-tools turquoise-icon mr-2"></em> <strong class="ucase">Trucks</strong></div>
                                        <div class="resources-table w-100">
                                            <div class="table-body">
                                                <div class="table-row" style="background-color: #19C3EB">
                                                    <div class="text-left ucase">Vehicle</div>
                                                    <div class="text-right ucase">Required/Allocated</div>
                                                    @*<div class="text-right ucase">Allocated</div>*@
                                                </div>
                                                <!-- ko foreach:daySummaryByRolesVehicles() -->
                                                <div class="table-row">
                                                    <div class="text-left pl-2" data-bind="text:rolName"></div>
                                                    <div class="text-right pr-2"><strong data-bind="text:vehicleResourcesRequired + '/' + vehicleResourcesAllocated"></strong></div>
                                                    @*<div class="text-right pr-2"><strong data-bind="text:vehicleResourcesAllocated"></strong></div>*@
                                                </div>
                                                <!-- /ko -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div><!--/row-->
                        </div><!--/tab-pane-->
                    </div><!--/tab-content-->
                </div><!--/modal-body-->
            </div><!--/modal-content-->
        </div><!--/modal-dialog-->
    </div><!--/modal-->
    <!-- Exceptions Modal -->
    <div class="modal fade" id="ExceptionsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content modal-content--dark-blue">
                <div class="modal-header align-items-center">
                    <h4 class="p-0 m-0"><em class="fas fa-exclamation-triangle mr-2 orange-icon"></em> Scheduler Exceptions</h4>
                    <button type="button" class="btn icon-only" data-dismiss="modal">
                        <em class="fas fa-times"></em>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row mt-0 mb-3">
                        <div class="col">
                            <label>
                                Date Range
                            </label>
                            <select data-style="btn-sm btn-white shadow-sm"
                                    data-none-selected-text="..."
                                    data-bind="selectPicker:true, options: schedulerExceptionsRangeFilterOptions, optionsText: 'value', optionsValue: 'id', value: schedulerExceptionsRangeFilterValue">
                            </select>
                        </div>
                        <div class="col">
                            <label>
                                Exception Types
                            </label>
                            <select data-style="btn-sm btn-white shadow-sm"
                                    data-none-selected-text="All Exceptions"
                                    data-bind="selectPicker:true, options: exceptionTypes, optionsText: 'value', optionsValue: 'id', selectedOptions: exceptionTypesFilters, valueAllowUnset: true"
                                    multiple>
                            </select>
                        </div>
                        <div class="col align-self-end">
                            Total Exceptions: <span data-bind="text:schedulerExceptionsFiltered().length"></span>
                        </div>
                    </div>
                    <div class="table-scrollable-container">
                        <table class="table grid fixed_header table--blue">
                            <thead>
                                <tr>
                                    <th scope="col" width="40%">Name</th>
                                    <th scope="col" width="50%">Exception Type</th>
                                    <th scope="col" width="10%">Date</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach:schedulerExceptionsFiltered">
                                <tr>
                                    <td data-bind="text:resourceName"></td>
                                    <td data-bind="text:exceptionName"></td>
                                    <td data-bind="text: moment(date).format('L')"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Global Search -->
    <div class="modal fade modal-fullscreen-xl globalSearch" id="globalSearch" tabindex="-1">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="input-group flex-nowrap">
                        <div class="input-group-prepend">
                            <span class="input-group-text globalSearch__btn"><i class="fas fa-search"></i></span>
                        </div>
                        <input type="text" class="form-control globalSearch__input" placeholder="Search ...">
                    </div>
                    <button type="button" class="close globalSearch__close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>




@if (!Model.IsMobileView)
{
    <div id="resources-panel" style="right: -450px; width: 450px; z-index: 1500;">
        <div class="btn btn-primary icon-only btn-toggle-resources shadow position-absolute" style="top: 30%"><em class="fas fa-align-right"></em></div>
        <div id="draggable" class="position-absolute"></div>
        <div id="resources" class="position-relative d-flex flex-column" style="height: 99vh; overflow: hidden">
            <div class="resources-header shadow">
                <div class="row align-items-center">
                    <div class="col-auto">
                        <ul class="nav nav-tabs" id="resourcesTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link ucase"
                                   data-bind="click: () => $root.resourceDisplayKind('skills'), css: {active:  $root.resourceDisplayKind() == 'skills'}"
                                   id="skills-tab"
                                   href="#skills"
                                   role="tab"
                                   aria-controls="skills"
                                   aria-selected="true">Skills</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link ucase"
                                   data-bind="click: () => $root.resourceDisplayKind('hoursworked'), css: {active: $root.resourceDisplayKind() == 'hoursworked'}"
                                   id="hours-tab"
                                   href="#skills"
                                   role="tab"
                                   aria-controls="hours"
                                   aria-selected="false">Hours Worked</a>
                            </li>
                            <li class="nav-item pull-right">
                                <!-- ko ifnot:resourceFilteringEnabled -->
                                <a class="nav-link ucase simulate-button" style="color: #0F2852;" title="Click to Toggle Filters dialog..." data-bind="click:$root.filteringPanelToggleOpen">
                                    <em class="fas fa-filter"></em>
                                </a>
                                <!-- /ko -->
                                <!-- ko if:resourceFilteringEnabled -->
                                <div style="display:inline-flex">
                                    <a class="nav-link ucase simulate-button pr-0" style="border: none;color: #f12424" title="Click to Toggle Filters dialog..." data-bind="click:$root.filteringPanelToggleOpen"><em class="fas fa-filter"></em></a>
                                    <a class="nav-link ucase simulate-button pl-1" title="Click to Close Filters dialog..." data-bind="click:$root.clearResourceFilters"><em class="fas fa-times-circle"></em></a>
                                </div>
                                <!-- /ko -->
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="pt-2 p-1" data-bind="visible:$root.filteringPanelOpen">
                            <div>
                                <hr />
                            </div>
                            <div class="d-flex flex-row">
                                <input type="text" class="form-control col-6" data-bind="textInput:nameFilter" placeholder="Search name..." />
                                <select class="ml-1 p-0 col-6"
                                        multiple
                                        id="locationFilteringSelectpicker"
                                        data-style="btn-white shadow-sm"
                                        data-none-selected-text="Select Location..."
                                        data-bind="selectPicker:true, options: $root.resourceLocations, optionsText: 'locationName', optionsValue: 'locationID', selectedOptions: resourceLocationsSelected, valueAllowUnset: true">
                                </select>
                            </div>
                            <div class="d-flex flex-row mt-2">
                                <select class="col-12 p-0"
                                        multiple
                                        id="roleFilteringSelectpicker"
                                        data-style="btn-white shadow-sm"
                                        data-none-selected-text="Select Roles..."
                                        data-bind="selectPicker:true, options: $root.resourceGroupFilterPV, optionsText: 'name', optionsValue: 'id', selectedOptions: resourceGroupFilterSelected, valueAllowUnset: true">
                                </select>
                            </div>
                            <div class="d-flex flex-row mt-1">
                                <div class="magic-checkbox-wrapper">
                                    <input class="magic-checkbox" type="checkbox" id="showAlsoServiceAccountResourcesCheck" data-bind="checked: showServiceAccountResources" />
                                    <label for="showAlsoServiceAccountResourcesCheck" style="font-size: 100%">Include Service Acct. Resources</label>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="flex-grow-1" style="overflow-y:scroll">
                <div class="tab-content" id="myTabContent" style="overflow-x: hidden">
                    <div class="tab-pane fade show active p-3" id="skills" role="tabpanel" aria-labelledby="skills-tab">
                        <div class="row align-items-center">
                            <div class="col-auto d-flex flex-column" id="ResourceCardListTop">
                                <!-- ko if:$root.resourceDisplayKind() == 'skills' -->
                                <h4>Resources - Skills</h4>
                                <!-- /ko -->
                                <!-- ko if:$root.resourceDisplayKind() == 'hoursworked' -->
                                <h4>Resources - Hours Worked</h4>
                                <!-- /ko -->
                            </div>
                            <div class="col text-right">
                            </div>
                        </div>
                        <!-- ko foreach: $root.resourceGroups() -->
                        <div><hr /><h5 data-bind="text: name"></h5></div>
                        <div class="row">
                            <!-- ko foreach: resources -->
                            <!-- ko if:apiResourceType==='HUMAN' -->
                            <!-- ko if:$root.resourceCardVisible(resourceName, resourceGroupName, locationLookupID, resource_ID, isAssignedToSvcAcctJob) -->
                            <div class="p-2" style="width:210px" data-bind="template: {name: 'resource-human-card-template'}"></div>
                            <!-- /ko -->
                            <!-- /ko -->
                            <!-- ko if:apiResourceType==='VEHICLE' -->
                            <!-- ko if:$root.resourceCardVisible(resourceName, resourceGroupName, locationLookupID, resource_ID, isAssignedToSvcAcctJob) -->
                            <div class="p-2" style="width:210px" data-bind="template: {name: 'resource-vehicle-card-template'}"></div>
                            <!-- /ko -->
                            <!-- /ko -->
                            <!-- /ko -->
                        </div>
                        <!-- /ko -->
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<!-- This has to be here becasue Trumbowyg does not receives the events if created usgin a partial view -->
<!-- ko with:emailJobDialog -->
<div class="modal fade" id="EmailJobDialog" tabindex="-1" data-backdrop="static" data-bind="showModal:isDialogDisplaying">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content modal-content--dark-blue">
            <div class="modal-header align-items-center">
                <h4 class="p-0 m-0"><em class="fas fa-envelope mr-2 turquoise-icon"></em>Email Job</h4>
                <button type="button" class="btn icon-only" data-bind="click:closeDialog">
                    <em class="fas fa-times"></em>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col">
                        <label>
                            Email Recipients
                        </label>
                        <select id="email-recipients-select"
                                multiple
                                data-style="btn-white shadow-sm"
                                data-none-selected-text="Select Email Recipients..."
                                data-bind="selectPicker:true, options: emailRecipients, optionsText: 'contactName', optionsValue: 'email', selectedOptions: emailRecipientsSelected, valueAllowUnset: true">
                        </select>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <label>
                            Email Body
                        </label>
                        <span class="custom-editor" data-bind="trumbowyg: emailBody" style="color:black; height: 300px"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <button type="button" class="btn btn-primary ml-auto px-5" data-bind="enable:emailRecipientsSelected().length > 0, click:saveEmailForDelivery">Send Email</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /ko -->
<!-- ko with:filtersDialog -->
<div class="modal fade" id="filtersDialog " tabindex="-1" data-backdrop="static" data-bind="showModal:isDialogDisplaying">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content modal-content--dark-blue">
            <div class="modal-header align-items-center">
                <h4 class="p-0 m-0"><em class="fas fa-filter mr-2 turquoise-icon"></em>Scheduler Jobs Filtering</h4>
                <button type="button" class="btn icon-only" data-bind="click:closeDialog">
                    <em class="fas fa-times"></em>
                </button>
            </div>
            <div class="modal-body">
                 <div class="row mt-3">
                    <div class="col">
                        <label>
                            Organization Location
                        </label>
                        <select data-style="btn-white shadow-sm"
                                data-none-selected-text="-- All locations --"
                                data-bind="selectPicker:true, options: $root.organizationLocations, optionsText: 'locationName', optionsValue: 'locationID', value: $root.jobFilters.selectedLocation, valueAllowUnset: true">
                        </select>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col">
                        <label>
                            Row Kind
                        </label>
                        <select multiple
                                id="row-kind-filter-multiselect"
                                data-style="btn-white shadow-sm"
                                data-none-selected-text="Select Line Kind..."
                                data-bind="selectPicker:true, options: $root.lineTypeFilterValues, optionsText: 'name', optionsValue: 'lineType', selectedOptions: $root.jobFilters.selectedRowKinds, valueAllowUnset: true">
                        </select>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col">
                        <label>
                            Filter by Customer
                        </label>
                        <select multiple
                                id="customer-filter-multiselect"
                                data-style="btn-white shadow-sm"
                                data-none-selected-text="Select Customer..."
                                data-bind="selectPicker:true, options: $root.dayCustomers, optionsText: 'customer_name', optionsValue: 'customer_id', selectedOptions: $root.jobFilters.customer, valueAllowUnset: true">
                        </select>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <label>
                            Filter by Status
                        </label>
                        <select data-style="btn-white shadow-sm"
                                data-none-selected-text="Select Status..."
                                data-bind="selectPicker:true, options: $root.jobsStatusFilterValues, optionsText: 'status_name', optionsValue: 'status_code', value: $root.jobFilters.showJobsOnStatus, valueAllowUnset: true">
                        </select>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <label>
                            Filter by PM
                        </label>
                        <select multiple
                                id="pm-filter-multiselect"
                                data-style="btn-white shadow-sm"
                                data-none-selected-text="Select PM..."
                                data-bind="selectPicker:true, options: $root.dayPMs, optionsText: 'projectManagerName', optionsValue: 'projectManagerId', selectedOptions: $root.jobFilters.pm, valueAllowUnset: true">
                        </select>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <div class="magic-checkbox-wrapper">
                            <input class="magic-checkbox" type="checkbox" id="showOnlyEmptyResourcesCheck" data-bind="checked: $root.jobFilters.showOnlyEmptyResources" />
                            <label for="showOnlyEmptyResourcesCheck">Show Only Jobs With Empty Resources</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <button type="button" class="btn btn-red px-5" data-bind="click:() => $root.jobFilters.clearFilters()">Clear Filters</button>
                    <button type="button" class="btn btn-primary ml-auto px-5" data-bind="click:closeDialog">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /ko -->



@await Html.PartialAsync("_EditJobModal")
@await Html.PartialAsync("_EmptyJobsModal")
@await Html.PartialAsync("_NotificationDialog")
@await Html.PartialAsync("_ScheduleJobSortingModal")