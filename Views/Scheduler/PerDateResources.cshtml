@model ServiceTRAX.Models.ViewModels.PerDateResourcesViewModel
@using ServiceTRAX.Identity

@{
    ViewData["Title"] = "Per Date Resources";
}

@section StyleSheets {
    <link rel="stylesheet" href="~/css/datepicker.css" />

    <style>
        .gridContent {
            position: absolute;
            border: solid 1px #c0c0c0;
            left: 20px;
            top: 180px;
            right: 20px;
            bottom: 30px;
        }
    </style>
}

@section Scripts {

    <link rel="stylesheet" href="~/css/mygrid.1.0.css" asp-append-version="true">
    <script language="javascript" type="text/javascript" src="~/lib/mygrid.1.0.js" asp-append-version="true"></script>
    <script type='text/javascript' src='~/lib/knockout/knockout-latest.js'></script>
    <script type='text/javascript' src='~/lib/moment/moment.min.js'></script>
    <script type='text/javascript' src='~/lib/datepicker.js'></script>
    <script type='text/javascript' src='~/js/ko-bindingHandlers.js' asp-append-version="true"></script>
    <script type='text/javascript' src='~/override/main-custom.js' asp-append-version="true"></script>


    <script type="text/javascript">
        var model =  @Html.Raw(Json.Serialize(Model));
        const gridName = 'ConfigScheduleDates';

        model.dateFrom = ko.observable(model.dateFrom);
        model.dateFrom.subscribe(function () { gridReset(); });
        model.dateTo = ko.observable(model.dateTo);
        model.dateTo.subscribe(function () { gridReset(); });


        model.gridParameters = () => ({
            'ORGANIZATION_ID': @Model.OrganizationID,
            'USER_ID': @User.GetUserID(),
            'FROMDATE': moment(model.dateFrom()).toISOString(),
            'TODATE': moment(model.dateTo()).toISOString()
        });
        model.gridEvents = {
          afterCreatedNewRecord: function (newDataRow) {
                // Set the Row organizationID value so the filtered dropdowns can work
                newDataRow["ORGANIZATION_ID"] = @Model.OrganizationID;
            }
        };
        let oGrid = new clsMyGrid(gridName, document.getElementById('tegGrid'), null, model.gridEvents, true, model.gridParameters());

        function gridReset() {
            oGrid.reset(gridName, model.gridEvents, model.gridParameters());
        }

        ko.bindingHandlers.selectPicker = ServiceTRAXBindingHandlers.selectPicker;
        ko.bindingHandlers.datepicker = ServiceTRAXBindingHandlers.datepicker;
        ko.applyBindings(model);

    </script>

}

<div id="content" class="pl-0">
    <div class="container-fluid pl-0">
        <div class="d-flex flex-row">
            <div class="ml-auto">
                <div class="form-inline" style="align-items:center">
                    <label class="mr-2">
                        Date From
                    </label>
                    <div class="input-group" id="triggerFromDate">
                        <input type="text"
                               autocomplete="off"
                               class="form-control m-0"
                               data-bind="datepicker: dateFrom, datepickerOptions: {  trigger: '#triggerFromDate' }"
                               required />
                        <div class="input-group-append simulate-button">
                            <span class="input-group-text input-group-append-custom">
                                <i class="fas fa-calendar"></i>
                            </span>
                        </div>
                    </div>
                    <label class="ml-5 mr-2">
                        Date To
                    </label>
                    <div class="input-group" id="triggerToDate">
                        <input type="text"
                               autocomplete="off"
                               class="form-control m-0"
                               data-bind="datepicker: dateTo, datepickerOptions: {  trigger: '#triggerToDate' }"
                               required />
                        <div class="input-group-append simulate-button">
                            <span class="input-group-text input-group-append-custom">
                                <i class="fas fa-calendar"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div id="content-wrap">
            <div class="gridContent myGrid" id="tegGrid"></div>
        </div>
    </div>
</div>
